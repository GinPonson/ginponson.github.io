[{"title":"spring websocket浏览器连接时出现404错误","date":"2017-02-09T13:51:42.000Z","path":"2017/02/09/spring-websocket-404/","text":"在用websocket做一个简单的数据导入页面同步显示后台进度功能的时候，浏览器出现连接不上的错误：WebSocket connection to &#39;ws://localhost:8080/project/marco&#39; failed: Error during WebSocket handshake: Unexpected response code: 404 网上有很种导致404的情况，但是都没有用，我在这里记录一下我的情况。以下是我的解决过程，要看解决办法的请直接到最后。spring-websocket.xml12345678&lt;websocket:handlers&gt;&lt;websocket:mapping handler=\"messageHandler\" path=\"/marco\" /&gt;&lt;websocket:handshake-interceptors&gt; &lt;bean class=\"com.project.websocket.HandshakeInterceptor\"/&gt;&lt;/websocket:handshake-interceptors&gt;&lt;/websocket:handlers&gt;&lt;bean id=\"messageHandler\" class=\"com.project.websocket.MessageHandler\"/&gt; 查看打印的INFO级别日志，根据spring的启动信息我们可以看到：12017-02-09 21:57:40,559 INFO [springframework.web.servlet.handler.SimpleUrlHandlerMapping] - Mapped URL path [/marco] onto handler of type [class org.springframework.web.socket.server.support.WebSocketHttpRequestHandler] WebSocketHttpRequestHandler通过SimpleUrlHandlerMapping注册了/marco地址，那应该是没错的啊，难道是客户端js的错误？1var websocket = new WebSocket('ws://' + window.location.host + '/project/marco'); 地址好像也没错啊，和Spring in Action4里面的例子一样的啊。为什么地址没有映射到/marco？先看看DispatchServlet的handlerMappings有没有/marco先吧。断点DispatchServlet的doDispatch()方法，随便发起一个请求：12345678910protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; ...... // Determine handler for the current request. mappedHandler = getHandler(processedRequest); if (mappedHandler == null || mappedHandler.getHandler() == null) &#123; noHandlerFound(processedRequest, response); return; &#125; ......&#125; 进入getHandler(processedRequest)12345678910111213protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception &#123; for (HandlerMapping hm : this.handlerMappings) &#123; if (logger.isTraceEnabled()) &#123; logger.trace( \"Testing handler map [\" + hm + \"] in DispatcherServlet with name '\" + getServletName() + \"'\"); &#125; HandlerExecutionChain handler = hm.getHandler(request); if (handler != null) &#123; return handler; &#125; &#125; return null;&#125; 我们看一下handlerMappings里面的内容，不知道你们有没有找到/marco，反正我是没找到。言下之意，/marco没注册到？ 没办法，我们断点SimpleUrlHandlerMapping的registerHandlers()方法和DispatchServlet的initHandlerMappings()方法。 我们看到SimpleUrlHandlerMapping的registerHandlers()先被执行。 最后退出registerHandlers()方法，F6一路下来，我们可以看到WebApplicationObjectSupport的initApplicationContext()方法中，context.beanFactory.beanDefintionMap中包含[org.springframework.web.servlet.handler.SimpleUrlHandlerMapping#0-&gt;RootBeanDefintion]，而且beanFactory.singletonObjects也包含了注册了/marco的SimpleUrlHandlerMapping实例。此时的context.configLocations是classpath:spring-context.xml。 DispatchServlet的initHandlerMappings()后被执行，我们来看这段：123// Find all HandlerMappings in the ApplicationContext, including ancestor contexts.Map&lt;String, HandlerMapping&gt; matchingBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerMapping.class, true, false); 然而，在matchingBeans没有找到我们要的注册了/marco的SimpleUrlHandlerMapping。此时的context.configLocations是classpath*:spring-servlet.xml 来到这里，你大概知道就是你的spring-websocket.xml放错位置啦。 解决办法如果你的web.xml分开加载spring-context和spring-servlet的话，请将spring-websocket的资源文件放到spring-servlet上加载。注意：这时候你的messageHandler应该是还没有初始化，请不要注入到某个server上。","tags":[{"name":"spring","slug":"spring","permalink":"http://yoursite.com/tags/spring/"},{"name":"websocket","slug":"websocket","permalink":"http://yoursite.com/tags/websocket/"}]},{"title":"知识点回顾-Jvm篇","date":"2017-02-05T07:17:45.000Z","path":"2017/02/05/review-jvm/","text":"","tags":[]},{"title":"知识点回顾-其他篇","date":"2017-02-02T13:24:14.000Z","path":"2017/02/02/review-others/","text":"复习完上面的一系列知识点，现在来复习一些剩余的知识点。这一篇复习redis，linux，这些知识点都是重要内功心法。 1、redis 什么是redis？redis能干什么？和M相比怎么样？ redis有哪些基本类型？ 如何用GET和SET实现INCR命令？ 怎么实现事务？redis的事务有什么特点？ redis如何实现缓存？ SORT命令有什么用？BY？GET？STORE？ redis怎么实现阻塞的任务队列？ redis怎么实现发布者-订阅者模型？ redis怎么优化？ redis持久化的方式？ 2、linux","tags":[{"name":"面试复习","slug":"面试复习","permalink":"http://yoursite.com/tags/面试复习/"}]},{"title":"知识点回顾-框架篇","date":"2017-02-01T12:20:50.000Z","path":"2017/02/01/review-framework/","text":"上一篇回顾完web的知识点,这篇来回顾常见的框架。Java的框架有很多，有很多也是造轮子，所以在恰当的场景使用恰当的轮子也是一件重要的事。 1、Spring全家桶 什么是spring？使用spring有什么好处？ 什么是IOC？ 什么是AOP？ 关于Spring的69个面试问答——终极列表Spring面试问答Top 25Spring面试问题集锦 2、Struts2 Struts2是什么？ 3、hibernate hibernate的理解？ N+1的解决办法？ hibernate的几种状态？ list和iterate不同之处 一级缓存和二级缓存和査询缓存 缓存算法？ 什么是事务？spring事务的传播方式？事务的隔离级别？ 事务并发处理 4、mybatis mybatis与hibernate相比怎么样？","tags":[{"name":"面试复习","slug":"面试复习","permalink":"http://yoursite.com/tags/面试复习/"}]},{"title":"知识点回顾-Web篇","date":"2017-01-31T05:37:11.000Z","path":"2017/01/31/review-java-web/","text":"上一篇回顾完java，这篇来回顾web的知识点。 1、TCP/IP协议 &amp;&amp; http协议 OSI七层模型？ TCP和UDP的特点？ 简单说一下TCP三次握手？ TCP的拥塞控制，和滑动窗口机制？ http协议有什么特点？ 浏览器请求到服务器响应的过程？ http和https的区别？ http的GET和POST方法有什么区别？ 什么是restful编程？ http的状态码？ 2、cookie &amp;&amp; session cookie和session有什么作用？ cookie是什么？session又是什么？ cookie和session有什么区别？ 3、servlet &amp;&amp; JSP servlet的生命周期？ servlet的原理？ servlet和JSP的关系？ dispatch和forward？ 什么时候调用doGet(),doPost()？ request.getAttribute()和request.getParamater()区别？ JSP的内置对象？ JSP的基本动作？ JSP动态include和静态include的区别？ 4、filter filter和servlet有什么区别？ filter的原理？ filter涉及的设计模式？ 5、服务器5.1、nginx 什么是nginx？nginx和Apache相比怎么样？ nginx能干什么？ nginx的基本操作命令？ nginx怎么设置代理服务器？ 正向代理和反向代理的区别？ 5.2、tomcat URL乱码？ Tomcat启动oom？ tomcat的优化经验？","tags":[{"name":"面试复习","slug":"面试复习","permalink":"http://yoursite.com/tags/面试复习/"}]},{"title":"知识点回顾-Java篇","date":"2017-01-29T01:42:15.000Z","path":"2017/01/29/review-knowledge/","text":"面临跳槽季，面试都是各种套路，为了避免被套路，根据自己会的知识点列出一张脑图来，脑补到时候考官会根据对应的知识点逐步细问。 将各个知识点切割开来，逐个细分，首先是编程语言的各个知识点 Java 什么是面向对象，面向对象的特征？ Java的多态机制？ 1、java.lang String、StringBuilder和StringBuffer的区别？ String的内部结构-&gt;substring的实现-&gt;1.7以前substring内存泄漏？ 为什么String被设计为final类？(final字段的作用) intern()的作用？ Class.forName作用，和static加载的区别？ 基本类型的封装对象的缓存机制 浮点数的计算问题 clone()? 2、java.io io使用的设计模式中的哪个模式？-&gt;作用？ 3、Collection &amp;&amp; Map Collection涉及的设计模式？-&gt;作用？ List和Set的区别？ 3.1、List、Stack、Queue Vector和ArrayList的区别？ ArrayList和LinkedList的实现？ Stack的特点？Queue的特点？ Java ConcurrentModificationException异常原因和解决方法？ 3.2、Set和Map 什么是哈希冲突？java是怎么解决哈希冲突的？ Comparable和Comparator有什么区别？ 有序set集合应该使用哪个？需要做什么？ java.lang.Object的equals()和hashCode()？ Hashtable和HashMap的区别？ 4、异常 受检异常和运行异常有什么不同？ Error和Exception有什么不同？ 异常的处理机制？ try{}catch{}finally{}的执行顺序？ 各举5个常见的异常 5、线程 &amp;&amp; java.util.concorrent 多线程的实现方法？ 同步的方法有哪些？它们之间有什么区别？ sleep和wait有什么区别？ ThreadLocal的作用？ Thread的生命周期？ 生产者和消费者模型？ ConcurrentHashMap和HashMap和Hashtable的区别？ 怎么实现一个线程池？ 阻塞队列？ 6、java.sql 操作数据库读取数据的过程？ 7、java.rmi 远程代理？","tags":[{"name":"面试复习","slug":"面试复习","permalink":"http://yoursite.com/tags/面试复习/"}]}]